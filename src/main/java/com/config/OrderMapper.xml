<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="OrderMapper">


	<select id="cartList" parameterType="MemberDTO" resultType="CartDTO">
		select p.product_name, p.product_price, p.product_quantity, p.product_id, i.product_img, c.user_id, c.cart_id, c.cart_quantity
		from t_product p join t_cart c
			on p.product_id = c.product_id
				join t_product_img i
					on p.product_id = i.product_id
		where c.user_id = '${user_id}'
		order by c.cart_id asc
	</select>
	
	<delete id="delCart" parameterType="MemberDTO">
		delete
		from t_cart
		where user_id = #{user_id}
	</delete>
	
	<insert id="orderInsert" parameterType="MemberDTO">

		insert into t_order (order_id, user_id, order_date, total_price, post, address1, address2, address_detail)
		values(orders_seq.nextval, #{user_id}, sysdate, #{total_price}, #{post}, #{address1}, #{address2}, #{address_detail})

		<selectKey keyProperty="order_id" resultType="int" order="AFTER">
			SELECT orders_seq.CURRVAL AS id FROM DUAL
		</selectKey>

	</insert>


	<insert id="orderDetailInsert" parameterType="OrderDTO">
		insert into t_order_detail
		values( order_detail_seq.nextval, #{order_id},#{product_id},#{order_quantity})
	</insert>


</mapper>