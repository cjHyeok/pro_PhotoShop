<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProductMapper">


	<select id="productList" parameterType="String" resultType="ProductDTO">
	    select p.product_id, p.product_name, p.product_price, p.product_description_summary, c.product_category_id , c.category_name, i.product_img
		from t_product p join t_product_cate c
								on p.product_category_id = c.product_category_id
                                join t_product_img i
								on p.product_id = i.product_id
        where c.category_name = #{category_name} and i.product_img_type = '1'
	</select>
	
	
	<select id="productListAll" parameterType="int" resultType="ProductDTO">
	    select p.product_id, p.product_name, p.product_price, p.product_description_summary, c.product_category_id , c.category_name, i.product_img, p.product_quantity
		from t_product p join t_product_cate c
								on p.product_category_id = c.product_category_id
                                join t_product_img i
								on p.product_id = i.product_id
		where p.product_id > 0 and i.product_img_type = '1'
		order by p.product_id desc
	</select>
	
	
	<select id="productMainList" parameterType="int" resultType="ProductDTO">
	    select p.product_id, p.product_name, p.product_price, p.product_description_summary, c.product_category_id , c.category_name, i.product_img
		from t_product p join t_product_cate c
								on p.product_category_id = c.product_category_id
                                join t_product_img i
								on p.product_id = i.product_id
								
		where i.product_img_type = '1' and p.product_best = 'best'						
		order by p.product_id desc

	</select>
	
	
	<select id="productDetails" parameterType="hashmap" resultType="ProductDTO">
		select p.product_id, p.product_name, p.product_price, p.product_description_summary, p.product_quantity, i.product_img, i.product_img_type, 
				i.product_sub_img_1, i.product_sub_img_2, i.product_sub_img_3, i.product_sub_img_4
		from t_product p join t_product_img i
                               	on p.product_id = i.product_id
		where p.product_id = #{product_id}
	</select>
	

	<insert id="productAdd" parameterType="ProductDTO">
                
 		INSERT ALL
			INTO t_product (product_id, product_category_id, product_name, product_price, product_quantity, product_description_summary, 
			product_description, product_sales_state)
      	  values(#{product_id},#{product_category_id}, #{product_name}, #{product_price}, #{product_quantity}, #{product_description_summary},
      	   #{product_description}, #{product_sales_state})
		
      	  INTO t_product_img (product_id, product_photo_id, product_img, product_sub_img_1, product_sub_img_2, product_sub_img_3, product_sub_img_4)
      	  values(#{product_id}, PRODUCT_PHOTO_ID_SEQ.nextval, #{product_img}, #{product_sub_img_1}, #{product_sub_img_2},#{product_sub_img_3},#{product_sub_img_4})
     	   SELECT *
      	FROM DUAL
        
	</insert>
</mapper>